---
import type { Language } from '@/i18n/config'
import type { MarkdownHeading } from 'astro'
import Button from '@/components/Button.astro'
import Footer from '@/components/Footer.astro'
import Header from '@/components/Header.astro'
import Navbar from '@/components/Navbar.astro'
import Sidebar from '@/components/Sidebar.astro'
import CodeCopyButton from '@/components/Widgets/CodeCopyButton.astro'
import GithubCard from '@/components/Widgets/GithubCard.astro'
import ImageZoom from '@/components/Widgets/ImageZoom.astro'
import MediaEmbed from '@/components/Widgets/MediaEmbed.astro'
import SoundEffect from '@/components/Widgets/SoundEffect.astro'
import { themeConfig } from '@/config'
import Head from '@/layouts/Head.astro'
import { getPageInfo } from '@/utils/page'
import '@/styles/comment.css'
import '@/styles/extension.css'
import '@/styles/font.css'
import '@/styles/global.css'
import '@/styles/lqip.css'
import '@/styles/markdown.css'
import '@/styles/transition.css'

interface Props {
  postTitle?: string
  postDescription?: string
  postSlug?: string
  supportedLangs?: Language[]
  headings?: MarkdownHeading[]
}

const { postTitle, postDescription, postSlug, supportedLangs = [], headings = [] } = Astro.props
const { isPost } = getPageInfo(Astro.url.pathname)
const fontStyle = themeConfig.global.fontStyle === 'serif' ? 'font-serif' : 'font-sans'
---

<html
  lang={Astro.currentLocale}
  class:list={[
    fontStyle,
    isPost ? 'scroll-smooth' : '',
  ]}
>
  <Head {postTitle} {postDescription} {postSlug} />
  <body>
    <div class="site-container">
      <!-- Top Header Area -->
      <div class="top-header-area">
        <Header />
        <Navbar />
      </div>

      <!-- Main Content Area with Sidebar -->
      <div class="content-wrapper">
        <main class="main-content">
          <slot />
        </main>
        <Sidebar headings={headings} isPost={isPost} />
      </div>

      <Footer />
    </div>
    <Button supportedLangs={supportedLangs} />
    <SoundEffect />
    <CodeCopyButton />
    <GithubCard />
    <MediaEmbed />
    <ImageZoom />
  </body>
</html>

<style>
.site-container {
  --at-apply: 'mx-auto min-h-dvh w-full';
  --at-apply: 'px-4 py-8 lg:(px-8 py-12)';
  max-width: 1200px;
}

.top-header-area {
  --at-apply: 'mb-8 lg:mb-10';
}

.content-wrapper {
  --at-apply: 'lg:(flex gap-8)';
}

.main-content {
  --at-apply: 'flex-1 min-w-0 mb-12';
}
</style>
