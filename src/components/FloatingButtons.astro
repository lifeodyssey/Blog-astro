---
import type { Language } from '@/i18n/config'
import LanguageSwitcherIcon from '@/assets/icons/language-switcher.svg'
import SearchIcon from '@/assets/icons/search-icon.svg'
import ThemeToggleIcon from '@/assets/icons/theme-toggle.svg'
import { moreLocales, themeConfig } from '@/config'
import { getNextGlobalLangPath, getNextSupportedLangPath } from '@/i18n/path'
import { ui } from '@/i18n/ui'
import { getPageInfo } from '@/utils/page'

interface Props {
  supportedLangs?: Language[]
}

const {
  light: { background: lightMode },
  dark: { background: darkMode },
} = themeConfig.color

const { supportedLangs = [] } = Astro.props
const currentPath = Astro.url.pathname
const { currentLang } = getPageInfo(currentPath)
const currentUI = ui[currentLang as keyof typeof ui] ?? {}

const showLanguageSwitcher = moreLocales.length > 0
const nextUrl = supportedLangs.length > 0
  ? getNextSupportedLangPath(currentPath, supportedLangs)
  : getNextGlobalLangPath(currentPath)
---

<div class="floating-container">
  <!-- Action Buttons -->
  <div class="floating-actions">
    <button
      id="search-button"
      class="floating-btn"
      aria-label={currentUI.search || 'Search'}
    >
      <SearchIcon aria-hidden="true" fill="currentColor" />
    </button>

    {showLanguageSwitcher && (
      <a
        id="language-switcher"
        href={nextUrl}
        class="floating-btn"
        aria-label="Switch language"
      >
        <LanguageSwitcherIcon aria-hidden="true" fill="currentColor" />
      </a>
    )}

    <button
      id="theme-toggle-button"
      class="floating-btn"
      data-light-mode={lightMode}
      data-dark-mode={darkMode}
      aria-label="Toggle theme"
    >
      <ThemeToggleIcon aria-hidden="true" fill="currentColor" />
    </button>
  </div>
</div>

<style>
.floating-container {
  /* Mobile: absolute position at top right */
  position: absolute;
  right: 7.25vw;
  top: 14.6rem;
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
  z-index: 50;
}

/* Desktop: fixed position on right side */
@media (min-width: 1024px) {
  .floating-container {
    position: fixed;
    bottom: min(10.27rem + 1.92vw, 12rem);
    right: max(5rem, calc(50vw - 35rem));
    top: auto;
  }
}

.floating-actions {
  --at-apply: 'flex flex-col gap-2';
}

.floating-btn {
  --at-apply: 'w-10 h-10 flex items-center justify-center';
  --at-apply: 'bg-background/80 backdrop-blur-sm rounded-lg shadow-sm';
  --at-apply: 'border border-secondary/10';
  --at-apply: 'c-secondary hover:c-primary transition-colors cursor-pointer';
}

.floating-btn svg {
  --at-apply: 'w-5 h-5';
}
</style>
