---
import type { MarkdownHeading } from 'astro'
import { ui } from '@/i18n/ui'
import { getPageInfo } from '@/utils/page'

interface Props {
  headings: MarkdownHeading[]
}

const { currentLang } = getPageInfo(Astro.url.pathname)
const currentUI = ui[currentLang as keyof typeof ui] ?? {}

const { headings = [] } = Astro.props
const filteredHeadings = headings.filter(heading => heading.depth >= 2 && heading.depth <= 4)
---

{filteredHeadings.length > 0 && (
  <div class="toc-container">
    <h3 class="toc-title">{currentUI.toc}</h3>
    <nav aria-label="Table of Contents">
      <ul class="toc-list">
        {filteredHeadings.map(heading => (
          <li
            class:list={{
              'toc-h2': heading.depth === 2,
              'toc-h3': heading.depth === 3,
              'toc-h4': heading.depth === 4,
            }}
          >
            <a href={`#${heading.slug}`} class="toc-link">
              {heading.text}
            </a>
          </li>
        ))}
      </ul>
    </nav>
  </div>
)}

<style>
.toc-container {
  --at-apply: 'p-4 bg-secondary/5 rounded-lg';
}

.toc-title {
  --at-apply: 'text-sm font-semibold c-primary mb-3';
}

.toc-list {
  --at-apply: 'list-none p-0 m-0 space-y-1.5 max-h-80 overflow-y-auto';
  scrollbar-width: thin;
}

.toc-h2 { --at-apply: 'ml-0'; }
.toc-h3 { --at-apply: 'ml-3'; }
.toc-h4 { --at-apply: 'ml-6'; }

.toc-link {
  --at-apply: 'text-xs c-secondary hover:c-primary transition-colors no-underline block py-0.5';
  --at-apply: 'text-balance line-clamp-2';
}

.toc-link:target-current {
  --at-apply: 'c-primary font-medium';
}
</style>
